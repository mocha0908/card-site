name: Daily Card Data Update

on:
  schedule:
    # æ¯æ—¥ æ—¥æœ¬æ™‚é–“ã®æœ9æ™‚ (UTC 0:00) ã«å®Ÿè¡Œ
    - cron: '0 0 * * *'
  workflow_dispatch: # æ‰‹å‹•å®Ÿè¡Œãƒœã‚¿ãƒ³ã‚‚æœ‰åŠ¹åŒ–

jobs:
  update-data:
    runs-on: ubuntu-latest
    
    steps:
      - name: ãƒªãƒã‚¸ãƒˆãƒªã‚’ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ
        uses: actions/checkout@v4

      - name: Pythonã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'

      - name: å¿…è¦ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
        run: |
          pip install selenium webdriver-manager beautifulsoup4 requests

      - name: è²©å£²ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–° (AR/CHR/SAR/SR/HR)
        run: |
          # 1. AR (ä¸Šæ›¸ã)
          python scraper.py --mode search --keyword "AR" --output card_data.csv --csv-mode overwrite --all-pages --headful
          
          # 2. CHR (è¿½è¨˜)
          python scraper.py --mode search --keyword "CHR" --output card_data.csv --csv-mode append --all-pages --headful
          
          # 3. SAR (è¿½è¨˜)
          python scraper.py --mode search --keyword "SAR" --output card_data.csv --csv-mode append --all-pages --headful
          
          # 4. SR (è¿½è¨˜)
          python scraper.py --mode search --keyword "SR" --output card_data.csv --csv-mode append --all-pages --headful
          
          # 5. HR (è¿½è¨˜)
          python scraper.py --mode search --keyword "HR" --output card_data.csv --csv-mode append --all-pages --headful

      # â˜…ã“ã“ã«è²·å–ãƒ‡ãƒ¼ã‚¿ã®æ›´æ–°ã‚³ãƒãƒ³ãƒ‰ã‚’è¿½åŠ ã§ãã¾ã™
      # - name: è²·å–ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°
      #   run: python kaitori_scraper.py ...

      - name: å¤‰æ›´ã‚’ã‚³ãƒŸãƒƒãƒˆã—ã¦ãƒ—ãƒƒã‚·ãƒ¥
        run: |
          git config --global user.name "github-actions[bot]"
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
          git add card_data.csv
          
          # å¤‰æ›´ãŒã‚ã‚‹å ´åˆã®ã¿ã‚³ãƒŸãƒƒãƒˆ
          if git diff --staged --quiet; then
            echo "å¤‰æ›´ãŒã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚"
          else
            git commit -m "ğŸ¤– è‡ªå‹•æ›´æ–°: è²©å£²ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°ã—ã¾ã—ãŸ"
            git push
          fi
